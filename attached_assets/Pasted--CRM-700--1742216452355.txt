Я рефакторил страницу посещаемости моего CRM-приложения, разделив монолитный файл (~700 строк) на отдельные файлы и модули согласно следующей структуре:

client/
  src/
    pages/
      attendance/
        index.tsx                   // Контейнер страницы AttendancePage
        components/
          AttendanceTable.tsx       // Компонент таблицы посещаемости
          CommentDialog.tsx         // Компонент модального окна для комментариев
          GroupsList.tsx            // Компонент списка групп
        hooks/
          useAttendanceData.ts      // Хук для загрузки данных: студентов, расписания, посещаемости, комментариев
          useAttendanceMutations.ts // Хук для мутаций: обновление/удаление/создание комментариев, массовая отметка
          useGroups.ts              // Хук для загрузки списка групп
После внедрения новой структуры модальное окно (Dialog) для страницы посещаемости открывается, но внутри окна возникают следующие проблемы:

Таблица посещаемости не функционирует корректно.
При клике на ячейки таблицы статус посещаемости не обновляется (отметки не меняются).
Компонент, отвечающий за массовую отметку (bulk attendance), не работает.
Функциональность комментариев нарушена.
При добавлении/обновлении комментария модальное окно не закрывается автоматически.
Toast-уведомления всегда показывают сообщение "Комментарий сохранен", даже если выполняется операция удаления или обновления.
Комментарии не обновляются/удаляются корректно.
Статистика посещаемости не отображается.
Расчёт процентного соотношения и количество посещений не выводятся в отдельном столбце, как было в старой версии.
Обновление данных.
После выполнения мутаций (например, добавления или удаления комментария) данные не обновляются должным образом, возможно, из-за некорректных query-ключей или неправильного вызова refetch/invalidate.
Пожалуйста, проанализируй предоставленные файлы (index.tsx, AttendanceTable.tsx, CommentDialog.tsx, GroupsList.tsx, useAttendanceData.ts, useAttendanceMutations.ts, useGroups.ts) и исправь ошибки так, чтобы:

Таблица посещаемости корректно обновляла статус по клику (через markAttendance и bulkAttendance).
Функционал комментариев работал корректно: можно добавлять, обновлять и удалять комментарии, а модальное окно закрывается после успешной операции и выводятся корректные уведомления.
Статистика посещаемости (например, процент посещаемости и количество посещённых занятий) вычисляется и отображается в таблице.
Все хуки используют согласованные query-ключи и после мутаций вызывается refetch/invalidate для обновления данных.
Модальное окно отображается поверх содержимого, как в старой версии.
Пожалуйста, предоставь исправленные версии всех файлов с полным кодом, чтобы я мог их сразу скопировать в своё приложение.