Привет!
У меня реализована функция добавления комментариев к датам на странице посещаемости (Attendance). Новые комментарии добавляются и отображаются корректно.
Проблема в том, что функция редактирования (обновления) комментариев не работает:
Когда я нажимаю «Изменить комментарий», всплывающее окно сообщает, что комментарий обновлён, но при наведении курсора на значок комментария в таблице всё ещё виден старый текст.
Также отсутствует функциональность удаления комментария.
Я подозреваю, что проблема может быть в следующих местах:
На сервере маршруты для обновления (PATCH /api/date-comments/:id) и удаления (DELETE /api/date-comments/:id) комментариев либо не реализованы, либо не работают должным образом.
Функции в storage.ts для обновления (updateDateComment) и удаления (deleteDateComment) комментариев могут работать не так, как нужно, либо не возвращать корректные данные.
На клиенте (в attendance.tsx) при вызове мутаций обновления или удаления не происходит правильное обновление кэша (invalidateQueries/refetchQueries), поэтому UI не перерисовывается с новыми данными.
Прошу тебя помочь мне:
Реализовать (или исправить) серверный маршрут для редактирования комментариев, чтобы он принимал PATCH-запрос по адресу /api/date-comments/:id, обновлял запись в базе и возвращал обновлённые данные.
Реализовать серверный маршрут для удаления комментария (DELETE /api/date-comments/:id).
Проверить и, при необходимости, исправить функции updateDateComment и deleteDateComment в storage.ts, чтобы они корректно обновляли/удаляли запись в таблице dateComments.
На клиенте (в attendance.tsx) добавить логику вызова этих маршрутов (например, использовать отдельные мутации для обновления и удаления) и правильно инвалидировать запросы, чтобы при успешном обновлении или удалении комментария UI сразу отображал новые данные.
В качестве примера, при редактировании комментария, если комментарий имеет id, нужно отправлять PATCH /api/date-comments/:id с новым текстом комментария, а при удалении – DELETE /api/date-comments/:id.
Пожалуйста, сгенерируй необходимый код или внеси правки, чтобы реализовать обновление и удаление комментариев корректно.